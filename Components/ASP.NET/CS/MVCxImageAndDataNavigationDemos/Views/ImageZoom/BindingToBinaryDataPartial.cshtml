@model IEnumerable
@{
    string ExpantWindowTextTemplate = "{0} {1}: {2:c}";
}
@Html.DevExpress().VerticalGrid(settings => {
    settings.Name = "VerticalGrid";
    settings.CallbackRouteValues = new { Controller = "ImageZoom", Action = "BindingToBinaryDataPartial" };
    settings.Width = Unit.Pixel(1);

    settings.Settings.HeaderAreaWidth = 150;
    settings.Settings.RecordWidth = 200;
    settings.SettingsPager.PageSize = 4;
    settings.SettingsSearchPanel.Visible = true;
    settings.Styles.Record.HorizontalAlign = HorizontalAlign.Left;

    settings.Rows.Add(r => {
        r.FieldName = "PhotoUrl";
        r.Caption = "Photo";
        r.RecordStyle.HorizontalAlign = HorizontalAlign.Center;
        r.SetDataItemTemplateContent(c => {
            Html.DevExpress().ImageZoom(zoomSettings => {
                zoomSettings.Name = "zoom" + c.ID;
                zoomSettings.LargeImageLoadMode = LargeImageLoadMode.OnPageLoad;
                zoomSettings.ShowHintText = false;
                zoomSettings.ExpandWindowText = string.Format(ExpantWindowTextTemplate, DataBinder.Eval(c.DataItem, "Brand"),
                    DataBinder.Eval(c.DataItem, "Model"), DataBinder.Eval(c.DataItem, "Price"));
                
                zoomSettings.ImageContentBytes = DataBinder.Eval(c.DataItem, "Photo") as byte[];
                zoomSettings.LargeImageContentBytes = DataBinder.Eval(c.DataItem, "LargePhoto") as byte[];
                zoomSettings.SettingsAutoGeneratedImages.ImageCacheFolder = "~\\Content\\ImageZoom\\Thumb";
                zoomSettings.SettingsAutoGeneratedImages.ImageWidth = Unit.Pixel(200);
                zoomSettings.SettingsAutoGeneratedImages.ImageHeight = Unit.Pixel(200);
                zoomSettings.SettingsAutoGeneratedImages.LargeImageWidth = Unit.Pixel(600);
                zoomSettings.SettingsAutoGeneratedImages.LargeImageHeight = Unit.Pixel(600);
                
                zoomSettings.SettingsZoomMode.ZoomWindowWidth = Unit.Pixel(350);
                zoomSettings.SettingsZoomMode.ZoomWindowHeight = Unit.Pixel(350);
                zoomSettings.SettingsZoomMode.ZoomWindowPosition = ZoomWindowPosition.Bottom;
                zoomSettings.ControlStyle.Border.BorderStyle = BorderStyle.None;
            }).GetHtml();
        });
    });
    settings.Rows.Add("Brand");
    settings.Rows.Add("Model");
    settings.Rows.Add(r => {
        r.FieldName = "Price";
        r.PropertiesEdit.DisplayFormatString = "c";
    });
    settings.Rows.Add(r => {
        r.FieldName = "Rating";
        r.SetDataItemTemplateContent(c => {
            ViewContext.Writer.Write(
                Html.DevExpress().RatingControl(rating => {
                    rating.Name = "RatingControl" + c.ID;
                    rating.ReadOnly = true;
                }).Bind(Convert.ToDecimal(c.Text)).GetHtml()
            );
        });
    });
    settings.Rows.Add(r => {
        r.FieldName = "ReviewCount";
        r.Caption = "Reviews";
        r.RowType = MVCxVerticalGridRowType.HyperLink;
        r.RecordStyle.HorizontalAlign = HorizontalAlign.Center;
        r.PropertiesEdit.DisplayFormatString = "{0} reviews";
        ((HyperLinkProperties)r.PropertiesEdit).NavigateUrlFormatString = "javascript:void(0)";
    });
}).Bind(Model).GetHtml()
