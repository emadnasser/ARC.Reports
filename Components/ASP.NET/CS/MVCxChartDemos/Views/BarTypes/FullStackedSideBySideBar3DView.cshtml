@model IList
<script type="text/javascript">
    $(window).load(UpdateLabelOptionsDisabled);

    function SetLabelOptionsEnabled() {
        $("#valueAsPercent")[0].disabled = false;
    }
    function UpdateLabelOptionsDisabled() {
        $("#valueAsPercent")[0].disabled = !($("#showLabels")[0].checked);
    }
</script>
@using (Html.BeginForm()) {
    ChartSideBySideBar3DDemoOptions options = (ChartSideBySideBar3DDemoOptions)ViewData[ChartDemoHelper.OptionsKey];
    
    <div class="chartOptionsPanel" style="height:auto; font-size:12px">
        <table style="width: 100%;">
            <tr>
                <td>
                    @Html.CheckBox("showLabels", options.ShowLabels, new { onclick = "UpdateLabelOptionsDisabled()" })
                </td>
                <td class="NoWrap">
                    <label for="showLabels" style="width:auto">Show Labels</label>
                </td>
                <td>
                    <div class="Spacer" style="width: 400px;"></div>
                </td>
                <td class="NoWrap">
                    <label>Group By: </label>
                </td>
                <td>
                    <div class="Spacer" style="width: 5px;"></div>
                </td>
                <td>
                    @Html.DropDownList("group", ChartDemoHelper.GetGroupByValues())
                </td>
                <td><div class="Spacer" style="width: 10px;"></div></td>
                <td class="NoWrap">
                    <label>Perspective Angle</label>
                </td>
                <td><div class="Spacer" style="width: 5px;"></div></td>
                <td>
                    @Html.DropDownList("perspectiveAngle", ChartDemoHelper.GetPerspectiveAngle())
                </td>
                <td></td>
            </tr>
            <tr>
                <td>
                    <div class="Spacer" style="width: 100%; height: 5px;"></div>
                </td>
            </tr>
            <tr>
                <td>
                    @Html.CheckBox("valueAsPercent", options.ValueAsPercent)
                </td>
                <td class="NoWrap" style="width: 120px;">
                    <label for="valueAsPercent" style="width:auto">Value As Percent</label>
                </td>
                <td colspan="5"></td>
                <td class="NoWrap">
                    <label>Zoom Percent</label>
                </td>
                <td><div class="Spacer" style="width: 5px;"></div></td>
                <td>
                    @Html.DropDownList("zoomPercent", ChartDemoHelper.GetZoomPercent())
                </td>
                <td><div class="Spacer" style="width: 14px;"></div></td>
                <td>
                    <input style="float: initial;" type="submit" value="Apply" onclick="UpdateLabelOptionsDisabled()" />
                </td>
            </tr>
        </table>
    </div>

    @Html.DevExpress().Chart(settings => {
        settings.Name = "chart";
        settings.BorderOptions.Visibility = DefaultBoolean.False;
        settings.Height = 500;
        settings.Width = 920;

        settings.Legends.Default(l => {
            l.AlignmentHorizontal = LegendAlignmentHorizontal.Center;
            l.AlignmentVertical = LegendAlignmentVertical.BottomOutside;
            l.Direction = LegendDirection.LeftToRight;
            l.Border.Visibility = DefaultBoolean.False;
            l.MaxHorizontalPercentage = 50;
        });

        settings.Series.Template(t => {
            t.Views().SideBySideFullStackedBar3DSeriesView(v => {
                v.SeriesLabel(l => {
                    l.ResolveOverlappingMode = ResolveOverlappingMode.Default;
                    l.TextPattern = options.ValueAsPercent ? "{VP:P0}" : "{V:0,,.00}";
                });
            });
            t.SetDataMembers("Country", "Population");
            t.LabelsVisibility = options.ShowLabels ? DefaultBoolean.True : DefaultBoolean.False;
        });

        settings.BoundDataChanged = (s, e) => {
            MVCxChartControl chart = (MVCxChartControl)s;
            foreach (Series series in chart.Series) {
                series.Views().SideBySideFullStackedBar3DSeriesView(v => {
                    if (options.Group == GroupBy.Sex)
                        v.StackedGroup = series.Name.Contains("Female") ? "Female" : "Male";
                    else {
                        if (series.Name.Contains("0-14"))
                            v.StackedGroup = "0-14 years";
                        else if (series.Name.Contains("15-64"))
                            v.StackedGroup = "15-64 years";
                        else
                            v.StackedGroup = "65 years and older";
                    }
                });
            };
        };
    
        settings.XYDiagram3D(d => {
            d.RotationMatrix = new double[] {
                0.766044443118978, -0.219846310392954, 0.604022773555054, 0,
                0, 0.939692620785908, 0.342020143325669, 0,
                -0.642787609686539, -0.262002630229385, 0.719846310392954, 0,
                0, 0, 0, 1
            };
            d.AxisX.Label.MaxWidth = 60;
            d.AxisY.Interlaced = true;
            d.AxisY.Label.TextPattern = "{VP:P0}";
            d.AxisY.NumericScaleOptions.GridSpacing = 0.2;
            d.RotationType = RotationType.UseAngles;
            d.RotationOrder = RotationOrder.XYZ;
            d.VerticalScrollPercent = 4;
            d.PerspectiveAngle = options.PerspectiveAngle;
            d.ZoomPercent = options.ZoomPercent;
        });

        settings.Titles.Add(new ChartTitle() {
            Text = "Population: Age Structure"
        });
        settings.Titles.Add(new ChartTitle() {
            Font = new Font("Tahoma", 12),
            Text = "Data estimate for mid-2016"
        });
        settings.Titles.Add(new ChartTitle() {
            Alignment = StringAlignment.Far,
            Dock = ChartTitleDockStyle.Bottom,
            Font = new Font("Tahoma", 8),
            TextColor = Color.Gray,
            Text = "From www.cia.com"
        });
    }).Bind(Model, seriesDataMember: "GenderAge").GetHtml()
}
